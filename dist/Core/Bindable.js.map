{"version":3,"sources":["../src/Core/Bindable.ts"],"names":[],"mappings":";;AAAA,4BAA4B;AAC5B,uCAAoC;AACpC,uCAAoC;AACpC,2CAAuD;AACvD,mCAAgC;AAShC,MAAM,cAAc,GAAqB;IACrC,OAAO,EAAE;QACL,YAAY,EAAE,GAAG;KACpB;IACD,SAAS,EAAE;QACP,IAAI,EAAE,IAAI;KACb;CACJ,CAAA;AAED;IAaI,YAAmB,KAAS,EAAE,OAA0B;QACpD,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC,KAAK,CAAC,EAAE,EAAE,cAAc,EAAE,OAAO,CAAC,CAAC;QACpD,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,IAAI,EAAE,CAAC;IAChB,CAAC;IAEO,IAAI;QACR,IAAI,CAAC,SAAS,GAAG,IAAI,qBAAS,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;QACvD,IAAI,CAAC,KAAK,GAAG,IAAI,aAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACvC,IAAI,CAAC,OAAO,GAAG,IAAI,iBAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACvC,IAAI,CAAC,OAAO,GAAG,IAAI,iBAAO,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;QAEjD,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,EAAW,EAAE,CAAU,EAAE,EAAE;YAC/C,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC;YAC1C,EAAE,CAAA,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;gBACpB,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;gBACtC,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,CAAC;YAChC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;IACzB,CAAC;IAEM,OAAO;QACV,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;IACxB,CAAC;IAEO,QAAQ;QACZ,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC;IACtB,CAAC;CACJ;AA3CD,2BA2CC","file":"Bindable.js","sourcesContent":["import * as _ from 'lodash';\nimport { Runtime } from './Runtime';\nimport { Watcher } from './Watcher';\nimport { WebSocket, ServerOptions } from './WebSocket';\nimport { Actor } from './Actor';\n\ntype BindableOptions = {\n    runtime? : {\n        tickInterval? : number,\n    },\n    websocket? : ServerOptions,\n}\n\nconst defaultOptions : BindableOptions = {\n    runtime: {\n        tickInterval: 500,\n    },\n    websocket: {\n        port: 8000,\n    }\n}\n\nexport default class Bindable<T extends object> {\n\n    private options : BindableOptions;\n\n    private model : T;\n\n    \n    // Internals\n    private runtime : Runtime;\n    private watcher : Watcher;\n    private websocket : WebSocket;\n    private actor : Actor;\n\n    public constructor(model : T, options? : BindableOptions) {\n        this.options = _.merge({}, defaultOptions, options);\n        this.model = model;\n        this.init();\n    }\n\n    private init() {\n        this.websocket = new WebSocket(this.options.websocket);\n        this.actor = new Actor(this.websocket);\n        this.watcher = new Watcher(this.model);\n        this.runtime = new Runtime(this.options.runtime);\n\n        this.runtime.everyTick((dt : number, i : number) => {\n            const changes = this.watcher.getChanges();\n            if(changes.length > 0) {\n                this.actor.flush(changes, this.model);\n                this.watcher.clearChanges();\n            }\n        });\n\n        this.runtime.start();\n    }\n\n    public destroy() : void {\n        this.runtime.stop();\n    }\n\n    private getModel() : T {\n        return this.model;\n    }\n}"]}